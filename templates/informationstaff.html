{% include "navbar.html" %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดอาจารย์</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/informationstaff.css' %}">
    
</head>
<body>
   
    <div class="container">
        <div class="row mt-4">
            <div class="col-6 col-lg-6 d-flex justify-content-start">
                {% if position == 'Dean' %}
                <h2 class="color">คณบดี</h2>
                {% elif position == 'Lecturer' %}
                <h2 class="color">รองคณบดี</h2>
                {% else %}
                <h2 class="color">อาจารย์</h2>
                {% endif %}
             

            </div>
            <div class="col-6 col-lg-6 d-flex justify-content-end">
                <a id="formreport-link" class="h2 color1" href="{% url 'formreport' %}">กำหนดเกณฑ์</a>
            </div>
            
            
           
        </div>
        {% for text in employees %}
        <div class="row mt-5 infor">
            <div class="col-1 d-flex justify-content-center h3">
                <h3 class="mt-1 dynamicNumber">1.</h3>
            </div>
            {% if text.profile  %}
            <div class="col-1 d-flex justify-content">
                <img class="mt-1" src="{{ text.profile.url }}" alt="50*50">
            </div>
            {% else %}
            <div class="col-1 d-flex justify-content">
                <img class="mt-1" src="{% static 'images/ftu_logo-removebg-preview.png' %}" alt="50*50">
            </div>
            {% endif %}

            <div class="col-4">
                <h3 class="d-flex justify-content-center">{{text.username.first_name}} {{text.username.last_name}}</h3>
            </div>
            <div class="custom-dropdown col-3 h3 d-flex justify-content-center" data-employee-id="{{ text.id }}">
                <div class="selected-option">Select Status</div>
                <ul class="options">
                    <li data-value="1">ยังไม่ตรวจ</li>
                    <li data-value="2">เรียบร้อย</li>
                </ul>
            </div>
            <div class="col-3">
                <a class="h3 d-flex justify-content-end" href="{% url 'report' text.id %}">รายละเอียดงาน</a>
            </div>
           
        </div>
        {% endfor %}
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const formReportLink = document.getElementById('formreport-link');
        
            formReportLink.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent the default link behavior
                const currentURL = window.location.href;
                const newURL = currentURL.replace('/informationstaff', '/formreport'); // Modify the URL path
                window.location.href = newURL; // Redirect to the new URL
            });
        });
        </script>
        
        <script>
            // Use JavaScript to dynamically increment the number for each row
            $(document).ready(function () {
                // Select all elements with the class 'dynamicNumber' and iterate over them
                $('.dynamicNumber').each(function (index) {
                    // Update the content of each element with the incremented number
                    $(this).text((index + 1) + ".");
                });
            });
        </script>
   
   <script>
    $(document).ready(function () {
        // Select all elements with the class 'custom-dropdown' and iterate over them
        $('.custom-dropdown').each(function () {
            const dropdown = $(this);
            const employeeId = dropdown.data('employee-id');

            // Handle the click event to show/hide the options
            dropdown.find('.selected-option').click(function () {
                dropdown.find('.options').toggle();
            });

            // Handle the click event on options
            dropdown.find('.options li').click(function () {
                const selectedValue = $(this).data('value');
                const selectedText = $(this).text();

                // Implement logic to update the status on the server (e.g., using AJAX)

                // Update the selected option
                dropdown.find('.selected-option').text(selectedText);

                // Store the selected status in local storage
                storeSelectedStatus(employeeId, selectedValue);

                // Hide the options
                dropdown.find('.options').hide();
            });

            // Set the initial value of the dropdown based on the stored value or get it from the server
            const storedStatus = getStoredStatus(employeeId);
            const initialStatus = storedStatus !== null ? storedStatus : getEmployeeStatus(employeeId);
            dropdown.find('.selected-option').text(initialStatus === '1' ? 'ยังไม่ตรวจ' : 'เรียบร้อย');

        });
    });

    // Implement a function to get the stored status from local storage
    function getStoredStatus(employeeId) {
        return localStorage.getItem('status_' + employeeId);
    }

    // Implement a function to store the selected status in local storage
    function storeSelectedStatus(employeeId, selectedStatus) {
        localStorage.setItem('status_' + employeeId, selectedStatus);
    }

    // Implement a function to get the employee status from the server
    function getEmployeeStatus(employeeId) {
  
        return Math.random() < 0.5 ? '1' : '2';
    }
</script>

</body>
</html>
